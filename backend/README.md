# Backend — Task Manager

Backend-часть веб-приложения для аутентификации и управления задачами в команде.

## Описание

Проект реализует REST API для:

- создания и управления списками задач
- назначения задач исполнителям
- установки дедлайнов для задач
- отметки выполнения задач
- привязки Telegram-аккаунта для будущей интеграции с ботом
- аутентификация — через стандартные сессии Django (админка)
- привязка Telegram через криптографически защищённые одноразовые токены
- простой rate-limit через кэш

## Технологии

- **Backend**: Django, Django REST Framework

## Установка и запуск

```bash

# клонируйте репозиторий
git clone https://github.com/tatitrif/task_manager.git

# перейдите в директорию приложения
cd task_manager/backend

# настройте .env (пример в .env.example)
cp .env.example .env

# сгенерировать новый SECRET_KEY
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"

# создайте миграцию
uv run python manage.py makemigrations tasks accounts

# примените миграцию
uv run python manage.py migrate

# создайте суперпользователя (администратора)
uv run python manage.py createsuperuser

# запустите сервер разработки
uv run python manage.py runserver

```

## Структура проекта

```
...
├── backend/ # Django-проект
│   ├── accounts/ # Пользователи, профили, Telegram-привязка
│   ├── config/ # Настройки Django (settings, urls, asgi)
│   ├── tasks/ # Логика задач и списков
│   ├── .env
│   ├── manage.py # точка запуска
│   ├── pyproject.toml # Конфигурация зависимостей для Django
│   └── README.md # информация о проекте
...

```

## Архитектура

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Веб-клиент    │    │   Django API     │    │  Telegram-бот   │
│                 │◄──►│                  │◄──►│                 │
│   JavaScript    │    │   Django ORM     │    │   Aiogram       │
│   WebSocket     │    │   Celery Tasks   │    │   API-запросы   │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                               │
                               ▼
                       ┌─────────────────┐
                       │   Redis Queue   │
                       │   PostgreSQL    │
                       └─────────────────┘
```

## API Endpoints

### Списки задач

| Метод   | Путь               | Описание                       |
|---------|--------------------|--------------------------------|
| `GET`   | `/api/lists/`      | Получить все мои списки задач  |
| `POST`  | `/api/lists/`      | Создать новый список задач     |
| `GET`   | `/api/lists/{id}/` | Получить детали списка по ID   |
| `PATCH` | `/api/lists/{id}/` | Частично обновить список задач |

### Задачи

| Метод   | Путь                          | Описание                                           |
|---------|-------------------------------|----------------------------------------------------|
| `GET`   | `/api/lists/{list_id}/tasks/` | Получить все задачи в списке                       |
| `POST`  | `/api/lists/{list_id}/tasks/` | Создать задачу в списке                            |
| `GET`   | `/api/tasks/`                 | Получить все задачи, назначенные мне               |
| `PATCH` | `/api/tasks/{id}/`            | Обновить задачу (например, исполнителя или статус) |
| `POST`  | `/api/tasks/{id}/complete/`   | Отметить задачу как выполненную                    |

### Telegram-привязка

| Метод  | Путь                          | Описание                                         |
|--------|-------------------------------|--------------------------------------------------|
| `POST` | `/api/auth/telegram/link/`    | Получить deep link для привязки Telegram         |
| `POST` | `/api/auth/telegram/confirm/` | Подтвердить привязку через токен и `telegram_id` |

## Принцип работы привязки Telegram

1. **Пользователь** запрашивает привязку Telegram-аккаунта в веб-приложении → вызывается endpoint, который
    - ссылку на Telegram-бот с **одноразовым токеном** для привязки или
    - генерирует **одноразовый токен** для привязки
2. **Пользователь**
    - переходит по ссылке → Telegram отправляет боту команду /start <token> или
    - копирует токен → пользователь пишет сообщение `/start <токен>`
3. В ответ **Telegram-бот** получает токен и telegram_id, отправляет их на эндпоинт подтвеждения
4. **Сервер**:
    - возвращает подтверждение привязки telegram_id или ошибку
    - после привязки бот может использовать telegram_id для идентификации пользователя в будущих запросах
